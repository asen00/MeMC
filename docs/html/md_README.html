<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.3"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MeMC: MeMC</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MeMC
   </div>
   <div id="projectbrief">Monte Carlo Simulation of Fluctuating Spherical Shells.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.3 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">MeMC </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >The MeMC is an open-source software package for monte-carlo simulation of elastic shells. The package can be useful to study the mechanics of biological nano-vesicles e.g. Exosomes.</p>
<p >Micro and nano vesicles play a crucial role in biology and medicine. The physical properties of these vesicles play an important role in their biological functions. Hence it is important to measure their elastic constants. One of the ways, to measure elastic constants of cells, is to poke them with Atomic Force Microscopy (AFM) tip to compute force-distance curve. Then the cell is modeled as a linear elastic material and by fitting this model to the experimental force-distance curve, the parameters of elastic model i.e. cell is estimated. However nano-vesicles differ from cells in two ways:</p>
<p >1) The nano-vesicles are much smaller hence thermal fluctuations may effectively renormalize the elastic coefficients. (<a href="https://journals.aps.org/prx/abstract/10.1103/PhysRevX.7.011002">Ko≈°mrlj &amp; Nelson, 2017</a>, <a href="https://www.pnas.org/doi/abs/10.1073/pnas.1212268109">Paulose et al., 2012</a>). 2) Cell membranes are strongly coupled to an underlying cytoskelton. Hence they may be modeled by a solid body (<a href="https://www.pnas.org/doi/abs/10.1073/pnas.202617299">HW et al., 2002</a>) but nano-vesicles must be modeled as liquid filled elastic membranes.</p>
<p >Hence, to be able to interpret the force-distance curve of nano-vesicles, we need to solve for the elastic response of thermally fluctuating elastic shell.</p>
<p >There are commercial packages, e.g. <a href="www.comsol.com">COMSOL</a>, to calculate the force-distance curve of solid bodies and closed membranes, but there are no package that include the thermal effects. The goal of this package is to bridge that gap.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Prerequisites</h1>
<p >MeMC requires following libraries:</p>
<p >1) A C++ compiler. We have tested the code against gnu <a href="https://gcc.gnu.org/">g++</a> versions 5.4.0 and above on x86_64 CPU.</p>
<p >2) <a href="https://www.hdfgroup.org/solutions/hdf5">Hdf5</a> libraries for reading and writing data. <br  />
</p>
<p >3) <a href="https://www.python.org/">Python</a> version with <a href="https://www.scipy.org">scipy</a>, <a href="https://www.numpy.org">numpy</a>, <a href="https://www.h5py.org">h5py</a> and <a href="https://https://pypi.org/project/numpy-quaternion/">numpy-quartenion</a> installed. We have tested the code against python version 3.8 and above.</p>
<p >For details of the installation for different packages, check the instructions on the official web page of the packages. If the operating system is Ubuntu then, g++ and hdf5 can be installed using the package manager apt,</p>
<div class="fragment"><div class="line">apt install g++ libhdf5-dev</div>
</div><!-- fragment --><p> The environment variables for include and library path may not be set properly after the installation. In such a scenario, the user should set these paths manually in the Makefile to compile the package.</p>
<p >In order to install the required python libraries we suggest using the standard python package manager pip, </p><div class="fragment"><div class="line">pip install scipy numpy-quaternion h5py</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2"></a>
Installation</h1>
<p >Once the prerequisites are satisfied, the installation of the MeMC amounts executing the following bash commands:</p>
<div class="fragment"><div class="line">git clone https://github.com/vipinagrawal25/MeMC</div>
<div class="line">cd MeMC</div>
<div class="line">make</div>
</div><!-- fragment --><p> If successful, one should find an extra <code>bin</code> directory in the folder. The bin directory will contain the binaries <code>exe_start</code> and <code>exe_memc</code>.</p>
<hr  />
<p> <b>NOTE</b> If the installation fails and shows the error</p>
<div class="fragment"><div class="line">In file included from hdf5.h:22:0,</div>
<div class="line">                 from src/hdf5_io.cpp:1:</div>
<div class="line">H5public.h:68:17: fatal error: mpi.h: No such file or directory</div>
<div class="line">compilation terminated.</div>
</div><!-- fragment --><p> then we suggest the user to compile the code as:</p>
<div class="fragment"><div class="line">make CC=/path/to/h5c++.</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
Using the Package:</h1>
<p >The package is built to understand the physics of Exosomes or viruses where the thermal noise are relevant. These nano-vesicles are studied experimentally using Atomic Force Microscopy. This package tends to simulate the experiment in the best possible way. Therefore, we expect the user to have a prior understanding of the Metropolis algorithm for the Monte Carlo simulation and a basic concept of Elasticity pertaining to membranes. Both the concept is described in detail in the document <code>paper/paper.pdf</code>. That being said, we shall now dive deeper and explain how different part of the code functions in the following sections:</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Constructing the membrane</h2>
<p >To begin the simulation we generate a equilibrated randomized position on a surface of a sphere. For details we refer the reader to <code>subsection grid</code> in <code>section numerical implementation</code> of <code>paper/paper.pdf</code>. The main code for this purpose is given in <code>main/start.cpp</code> and the relevant executable is <code>bin/exe_start</code>. The executable takes three arguments: 1) Number of random points to be equilibrated 2) Geometry of the surface <code>sph</code> for a surface of sphere and <code>cart</code> for flat plane 3) Folder name inside which the outputs will be written. 4) Number of monte-carlo steps</p>
<p >Rest of the parameter are hard coded. For instance, the radius of the sphere on which we generate randomize positions is unity.</p>
<p >In order to generate a randomized configuration of 1024 points in surface of sphere with radius one, the user can execute</p>
<div class="fragment"><div class="line">./bin/exe_start 1024 sph data_sph 60000</div>
</div><!-- fragment --><p> All the outputs will be dumped inside <code>data_sph</code>.</p>
<hr  />
<p> <b>NOTE</b></p>
<p >The simulation will run for 60000 Monte Carlo steps, which will take more than 2 hours to complete. To proceed with the other sections it is sufficient to kill the simulation after 1000 Monte Carlo steps. The user can give smaller steps as well.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Triangulating the surface</h2>
<p >The surface of the membrane will respond to all the internal and external forces present. The internal ones are due to bending or stretching. If the user has read the <code>subsection energy</code> in <code>section numerical implementation</code> of the document, then evaluation of these forces requires the knowledge of all the neighbours of a point. For this purpose we rely on the python wrapper for <a href="qhull.org">qhull</a>, known as ConvexHull. We provide a utility script, <code>utils/gen_memc_conf.py</code> which takes the output from the <code>exe_start</code>, set all the connections and write the output as <code>conf/dmemc_conf.h5</code>. Additionally the positions of the particle is written in <code>conf/dmemc_pos.h5</code>. The user can copy paste the following command to set the connection for dump <code>data_sph/snap_0003.h5</code>.</p>
<div class="fragment"><div class="line">python utils/gen_memc_conf.py data_sph/snap_0003.h5.</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md8"></a>
MeMC</h2>
<p >Once the connections are set, the executable <code>bin/exe_memc</code> can be used to numerically study the nano-vesicles. The binary takes two arguments: 1) Name of the parameter file from which all the physical parameters is read. 2) The folder name to store all the data.</p>
<p >The para file is not a format-free input. The variables has to be in the specified format to be read correctly. We urge the user to copy the following block and paste them identically to a plain text file for input.</p>
<div class="fragment"><div class="line">## Membrane parameters</div>
<div class="line">N   coef_bending    coef_stretching coef_vol_expansion sp_curve</div>
<div class="line">1024  2.50          25.00            1000000.00        2.0</div>
<div class="line">radius  pos_bot_wall    sigma   epsilon   theta_attractive</div>
<div class="line">1.00     -1.05          0.17     4.00     0.52</div>
<div class="line">## Montecarlo parameters</div>
<div class="line">Dfac    kBT mc_total_iters  mc_dump_iter</div>
<div class="line">4       1.00  50000            100</div>
<div class="line">## Afm Tip parameters</div>
<div class="line">tip_radius  tip_pos_z   afm_sigma   afm_epsilon</div>
<div class="line">0.20         1.05       0.17         4.00</div>
<div class="line">`````</div>
<div class="line"> </div>
<div class="line">Values of the parameter are stored directly below the name. For instance the number</div>
<div class="line">of points used to represent the membrane above is 1024 (The number below N). The other parameters which can be varied are:</div>
<div class="line"> </div>
<div class="line">* **Membrane specific parameter**</div>
<div class="line">    +  coef_bending : `B` in paper/paper.pdf</div>
<div class="line">    +  coef_stretching : Young&#39;s modulus (`Y`) in paper/paper.pdf</div>
<div class="line">    +  coef_vol_expansion : the bulk&#39;s modulus in paper/paper.pdf</div>
<div class="line">    +  sp_curve :: spontaneous curvature (`C`) in paper/paper.pdf. </div>
<div class="line">    +  radius :: `R` in paper/paper.pdf. (**Note**: We have tested the code only for `R=1`)</div>
<div class="line"> </div>
<div class="line">* **Parameters for the bottom stick wall**</div>
<div class="line">    + pos_bot_wall :: z-position of the bottom wall. The value must be smaller than the radius</div>
<div class="line">    + sigma :: The &lt;img src=&quot;https://render.githubusercontent.com/render/math?math={\sigma}&quot;&gt;  of the bottom LJ potential</div>
<div class="line">    + epsilon :: Relative strength LJ potential</div>
<div class="line">    + theta_attractive :: All the points for which &lt;img src=&quot;https://render.githubusercontent.com/render/math?math={\Theta}&quot;&gt;  (shaded part in the fig just below) is less this value will be affected by the attractive surface.</div>
<div class="line"> </div>
<div class="line">* **Monte Carlo Parameters**</div>
<div class="line">    + Dfac :: Monte Carlo step is divided by Dfac.</div>
<div class="line">    + kBT :: Boltzmann constant multiplied by temperature.</div>
<div class="line">    + mc_total_iters :: Total number of Monte Carlo iterations.</div>
<div class="line">    + mc_dump_iters :: Position snapshots are dumped after mc_dump_iter.</div>
<div class="line">    </div>
<div class="line">* **AFM parameters**</div>
<div class="line">    + tip_radius :: The size of afm tip (see section `AFM tip` in paper/paper.pdf)</div>
<div class="line">    + tip_pos_z :: Position of the bottom of the tip</div>
<div class="line">    + afm_sigma :: The &lt;img src=&quot;https://render.githubusercontent.com/render/math?math={\sigma}&quot;&gt; of the AFM potential (see paper/paper.pdf)</div>
<div class="line"> </div>
<div class="line">Apart from the above, it is also expected to have a directory `conf` with file by the name `dmemc_conf.h5` inside it in the simulation directory. Once all is ensured, and the parameters are copied in a text file `para_file.in`, copy paste the following to run the simulation. </div>
<div class="line">&lt;p align=&quot;center&quot;&gt;</div>
<div class="line">&lt;img src=&quot;./paper/fig/describe_theta.png&quot; width=&quot;200&quot; /&gt;</div>
<div class="line">&lt;/p&gt;</div>
<div class="line"> </div>
<div class="line">&lt;!-- ![plot](./doc/figs/describe_theta.png) --&gt;</div>
<div class="line"> </div>
<div class="line">```bash</div>
<div class="line">./bin/exe_memc para_file.in out_memc</div>
</div><!-- fragment --><p> <b>NOTE</b> The radius can be kept unity and all the parameters are scaled accordingly. For example, to study the effect of 10nm AFM tip over a 100nm exosome, one should take radius 1 and tip_radius = 1/20.</p>
<h1><a class="anchor" id="autotoc_md9"></a>
Example</h1>
<p >An example shell script with proper calls to the binaries and utilities functions can be found inside folder <code>Examples</code>. The script is named <code>execute.sh</code>. Change the directory to Examples in terminal and paste the following for execution.</p>
<div class="fragment"><div class="line">sh execute.sh</div>
</div><!-- fragment --><p >The code takes about 30 minutes on Intel(R) Core(TM) i5-8265U CPU. Once completed, the results can be verified against the simulation we have conducted. Use the <a href="https://www.gnuplot.org">Gnuplot</a> script <code>plot.gnu</code>, which compares the histogram of total energies written by <code>exe_start</code> and <code>exe_memc</code> to the histogram for the same (<code>hist_start.dat</code> and <code>hist_memc.dat</code>) we had evaluated. The following command should do the trick. </p><div class="fragment"><div class="line">gnuplot plot.gnu</div>
</div><!-- fragment --><p> Two plot windows similar to A and B should open. In both the figures, the continuous line is the result from the simulation conducted locally.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Energy histogram for randomization   </th><th class="markdownTableHeadCenter">Energy histogram for fluctuating membran    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><img src="./paper/fig/hist_start.png" alt="gnu_plta" class="inline"/>   </td><td class="markdownTableBodyCenter"><img src="./paper/fig/hist_memc.png" alt="gnu_pltb" class="inline"/>   </td></tr>
</table>
<p ><b>NOTE</b> In case the plot script fails to generate the plot, the main reason could be lack of <a href="https://www.gsl.org">gsl-histogram</a> in your local machine. We suggest to use numpy or other standard libraries for the same purpose. We have omitted top 6000 data points while generating the histogram. </p>
<h1><a class="anchor" id="autotoc_md10"></a>
Data Structure</h1>
<p >Both the binaries <code>exe_start</code> and <code>exe_memc</code> outputs the percentage of accepted moves in the second column and total energy in the third column of the configuration of <code>mc_log</code>. In the first column, we write the iteration of Monte Carlo. In <code>mc_log</code> file written by <code>exe_memc</code>, the fourth, fifth, sixth, seventh, and the eighth column respectively stores the energy due to <b>stretching,bending, sticking, the afm contribution and the volume</b>.</p>
<p >Apart from the <code>mc_log</code> snapshot of the positions constituting the membrane are dumped every <code>mc_dump_iter</code> step in the para file. We use Hierarchical Data Format or the HDF5 library. In both the case, we write the positions in <code>snap_xx.h5</code> series, where <code>xx</code> represents Monte Carlo iterations divide by <code>mc_dump_iter</code>.</p>
<h1><a class="anchor" id="autotoc_md11"></a>
Visualization</h1>
<p >Visualization of membrane can be done using <a href="https://visit-dav.github.io/visit-website/index.html">visit</a> or <a href="https://www.paraview.org">paraview</a>. We provide a python utility to convert the hdf5 file to vtk format, <code>utils/viz_memc.py</code>. The program takes three arguments: 1) Snapshot from the <code>exe_memc</code> 2) The file with connections, or <code>conf/dmemc_conf.h5</code> 3) Name of the output file with extension <code>.vtk</code> which will be read from Visit.</p>
<p >The user can paste the following in the terminal </p><div class="fragment"><div class="line">python utils/viz_memc.py out_memc/snap_0000.h5 conf/dmemc_conf.h5 viz_000.vtk </div>
<div class="line">python utils/viz_memc.py out_memc/snap_0010.h5 conf/dmemc_conf.h5 viz_010.vtk</div>
</div><!-- fragment --><p >If the execution is successful, the file <code>viz_000.vtk</code> and <code>viz_010.vtk</code> will be written in the root directory. In visit load the .vtk file and select <code>subset-&gt;domains</code> or <code>mesh-&gt;mesh</code> to see the result.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">Random points before equilibration   </th><th class="markdownTableHeadCenter">Random lattice ( viz_000.vtk)   </th><th class="markdownTableHeadCenter">Fluctating membrane (viz_010.vtk)    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><img src="./paper/fig/rand_visit.png" alt="" class="inline"/>   </td><td class="markdownTableBodyCenter"><img src="./paper/fig/latt_visit.png" alt="" class="inline"/>   </td><td class="markdownTableBodyCenter"><img src="./paper/fig/exo_visit.png" alt="" class="inline"/>   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md12"></a>
A typical workflow</h1>
<p >We summarize the typical workflow on a Linux Desktop. Our suggestion might not be the best. The users are free to decide on the workflow which suits their need the best.</p><ul>
<li>Clone the Repository. <div class="fragment"><div class="line">git clone https://github.com/vipinagrawal25/MeMC</div>
</div><!-- fragment --></li>
<li>Change directory to MeMC and install.</li>
</ul>
<div class="fragment"><div class="line">cd MeMC</div>
<div class="line">make</div>
</div><!-- fragment --><ul>
<li>Create an environment variable say <code>MEMC_PATH</code>.</li>
</ul>
<div class="fragment"><div class="line">MEMC_PATH = $pwd</div>
</div><!-- fragment --><ul>
<li>Append to environment variable the <code>bin</code> directory inside <code>MeMC</code></li>
</ul>
<div class="fragment"><div class="line">export PATH = $MEMC_PATH/bin:$PATH</div>
</div><!-- fragment --><ul>
<li>Create a directory anywhere in the machine for the purpose of simulation.</li>
<li>In the directory start the randomization of N points.</li>
</ul>
<div class="fragment"><div class="line">exe_start N sph data_sph</div>
</div><!-- fragment --><ul>
<li>Once completed, set the connection using one of the later snapshot, e.g.</li>
</ul>
<div class="fragment"><div class="line">python $MEMC_PATH/utils/gen_memc_conf.py data_sph/snap_0300.h5</div>
</div><!-- fragment --><ul>
<li>Change N in the parafile to what you had chosen and start the MeMC simulation</li>
</ul>
<div class="fragment"><div class="line">exe_memc para_file.in out </div>
</div><!-- fragment --><ul>
<li>Lower the tip position by changing tip_pos_z in parafile. Note, if the tip_pos_z penetrates the membrane then we use the snapshot from earlier simulation where the tip position was higher.</li>
</ul>
<h1><a class="anchor" id="autotoc_md13"></a>
Checking  Execution Status</h1>
<p >Here we discuss various checks that can be done to ensure that the execution of both <code>exe_start</code> and <code>exe_memc</code> is sound. If the user sees following message ` x0 = 0, y0 = 0, z0 = 0; Points representing exosome very small... See section Checking execution status in <a href="https://github.com/vipinagrawal25/MeMC/blob/main/README.md">https://github.com/vipinagrawal25/MeMC/blob/main/README.md</a> ` printed in the terminal window, the execution of the software is most likely bad.</p>
<p >We provide a utility program <code>utils/check_status.py</code> to check at what stage the execution is failing. Note that the user needs to install <a href="https://matplotlib.org/">matplotlib</a>. See instructions <a href="https://pypi.org/project/matplotlib/">here</a>.</p>
<p >The utility file takes two arguments; 1) <code>start</code> or <code>memc</code> depending upon which executable has written the output 2) The output file of <code>exe_start</code> or <code>exe_memc</code></p>
<p >Example execution of the script would be;</p>
<div class="fragment"><div class="line">python utils/check_status.py start data_sph/snap_0300.h5</div>
<div class="line">python utils/check_status.py memc out/snap_0001.h5</div>
</div><!-- fragment --><p >The example plot window of good and bad execution of the software is shown below. In the figure <img src="https://render.githubusercontent.com/render/math?math={\cos(\theta)-\phi}" alt="" class="inline"/> is plotted as X and Y co-ordinate. A bad execution implies all the points representing the Exosome is either NaN or 0.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadCenter">good execution   </th><th class="markdownTableHeadCenter">bad execution    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyCenter"><img src="./paper/fig/good_exe.png" alt="" class="inline"/>   </td><td class="markdownTableBodyCenter"><img src="./paper/fig/bad_exe.png" alt="" class="inline"/>   </td></tr>
</table>
<p >In case user sees the right figure (bad one) for both <code>exe_start</code> and <code>exe_memc</code>, then most likely the hdf5 library is not installed properly. Please reinstall the library or modify relevant section of the code inside <code><a class="el" href="hdf5__io_8cpp.html">src/hdf5_io.cpp</a></code> for I/O suited for the user.</p>
<p >In case the bug is in the <code>h5py</code>, the user is requested to use the <a href="https://support.hdfgroup.org/products/hdf5_tools/toolsbycat.html">hdf5-tools</a> to debug. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.3
</small></address>
</body>
</html>
